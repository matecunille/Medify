{% extends "base.html" %}

{% block title %}Registro{% endblock %}

{% block content %}
<div class="d-flex justify-content-center align-items-center" style="min-height: 100vh; background-color: #f8f9fa;">
    <div class="card shadow-lg rounded-4 p-4" style="width: 100%; max-width: 460px;">
        <h1 class="text-center mb-4 fw-bold" style="font-family: 'Segoe UI', sans-serif; font-size: 2.5rem;">Crear cuenta</h1>

        <form method="post">
            {% csrf_token %}

            {% for error in form.non_field_errors %}
                <div class="alert alert-danger">{{ error }}</div>
            {% endfor %}

            {% for field in form %}
                {% for error in field.errors %}
                    <div class="alert alert-danger">{{ error }}</div>
                {% endfor %}
            {% endfor %}

            <div class="form-floating mb-3">
                <input type="text" name="nombre" id="{{ form.nombre.id_for_label }}" class="form-control"
                       placeholder="Nombre" required value="{{ form.nombre.value|default:'' }}">
                <label for="{{ form.nombre.id_for_label }}">Nombre</label>
            </div>

            <div class="form-floating mb-3">
                <input type="text" name="apellido" id="{{ form.apellido.id_for_label }}" class="form-control"
                       placeholder="Apellido" required value="{{ form.apellido.value|default:'' }}">
                <label for="{{ form.apellido.id_for_label }}">Apellido</label>
            </div>

            <div class="form-floating mb-3">
                <input type="text" name="username" id="{{ form.username.id_for_label }}" class="form-control"
                       placeholder="Usuario" required value="{{ form.username.value|default:'' }}">
                <label for="{{ form.username.id_for_label }}">Usuario</label>
            </div>

            <div class="form-floating mb-3">
                <input type="email" name="email" id="{{ form.email.id_for_label }}" class="form-control"
                       placeholder="Email" required value="{{ form.email.value|default:'' }}">
                <label for="{{ form.email.id_for_label }}">Email</label>
            </div>

            <div class="form-floating mb-3">
                <input type="password" name="password" id="{{ form.password.id_for_label }}" class="form-control"
                       placeholder="Contraseña" required>
                <label for="{{ form.password.id_for_label }}">Contraseña</label>
            </div>

            <div class="form-floating mb-3">
                <input type="password" name="confirm_password" id="{{ form.confirm_password.id_for_label }}" class="form-control"
                       placeholder="Confirmar contraseña" required>
                <label for="{{ form.confirm_password.id_for_label }}">Confirmar Contraseña</label>
            </div>

            <div class="form-floating mb-3">
                <input type="text" name="dni" id="{{ form.dni.id_for_label }}" class="form-control"
                       placeholder="DNI" value="{{ form.dni.value|default:'' }}">
                <label for="{{ form.dni.id_for_label }}">DNI</label>
            </div>

            <div class="form-floating mb-3">
                <select class="form-select" id="{{ form.rol.id_for_label }}" name="rol" required onchange="toggleEspecialidad()">
                    <option value="" disabled {% if not form.rol.value %}selected{% endif %}>Seleccionar rol</option>
                    <option value="paciente" {% if form.rol.value == "paciente" %}selected{% endif %}>Paciente</option>
                    <option value="medico" {% if form.rol.value == "medico" %}selected{% endif %}>Médico</option>
                </select>
                <label for="{{ form.rol.id_for_label }}">Rol</label>
            </div>

            <div class="form-floating mb-3" id="especialidad-container" style="display: none;">
                <input type="text" name="especialidad" id="{{ form.especialidad.id_for_label }}" class="form-control"
                       placeholder="Especialidad" value="{{ form.especialidad.value|default:'' }}">
                <label for="{{ form.especialidad.id_for_label }}">Especialidad</label>
            </div>

            <button type="submit" class="btn btn-success w-100 btn-lg">Registrarse</button>
        </form>

        <div class="mt-3 text-center">
            <small class="text-muted">¿Ya tenés cuenta? <a href="/usuarios/login/" class="text-decoration-none">Iniciar sesión</a></small>
        </div>
    </div>
</div>

<script>
    function toggleEspecialidad() {
        const rol = document.getElementById("{{ form.rol.id_for_label }}").value;
        const especialidadContainer = document.getElementById("especialidad-container");
        especialidadContainer.style.display = rol === "medico" ? "block" : "none";
    }
    window.addEventListener("DOMContentLoaded", toggleEspecialidad);
</script>
{% endblock %}